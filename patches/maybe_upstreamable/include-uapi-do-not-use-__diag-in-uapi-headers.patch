From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Wed, 26 May 2021 12:51:22 +0200
Subject: [PATCH] {MAYBE UPS} include/uapi: do not use __diag in uapi headers

HDRTEST fails when using __diag macro.
---
 include/uapi/linux/netfilter/nf_conntrack_common.h | 5 +----
 include/uapi/linux/nl80211.h                       | 5 +----
 2 files changed, 2 insertions(+), 8 deletions(-)

diff --git a/include/uapi/linux/netfilter/nf_conntrack_common.h b/include/uapi/linux/netfilter/nf_conntrack_common.h
index 25c3364ba900..9d6d1a63e97f 100644
--- a/include/uapi/linux/netfilter/nf_conntrack_common.h
+++ b/include/uapi/linux/netfilter/nf_conntrack_common.h
@@ -4,8 +4,6 @@
 /* Connection state tracking for netfilter.  This is separated from,
    but required by, the NAT layer; it can also be used by an iptables
    extension. */
-__diag_push()
-__diag_ignore(CLANG, 10, "-Wduplicate-enum", "Some entries are duplicated")
 enum ip_conntrack_info {
 	/* Part of an established connection (either direction). */
 	IP_CT_ESTABLISHED,
@@ -26,7 +24,7 @@ enum ip_conntrack_info {
 	/* No NEW in reply direction. */
 
 	/* Number of distinct IP_CT types. */
-	IP_CT_NUMBER,
+	IP_CT_NUMBER = IP_CT_RELATED_REPLY + 1,
 
 	/* only for userspace compatibility */
 #ifndef __KERNEL__
@@ -35,7 +33,6 @@ enum ip_conntrack_info {
 	IP_CT_UNTRACKED = 7,
 #endif
 };
-__diag_pop()
 
 #define NF_CT_STATE_INVALID_BIT			(1 << 0)
 #define NF_CT_STATE_BIT(ctinfo)			(1 << ((ctinfo) % IP_CT_IS_REPLY + 1))
diff --git a/include/uapi/linux/nl80211.h b/include/uapi/linux/nl80211.h
index b474996d2e11..82e363705c4f 100644
--- a/include/uapi/linux/nl80211.h
+++ b/include/uapi/linux/nl80211.h
@@ -4710,8 +4710,6 @@ enum nl80211_bss_status {
  *	trying multiple times); this is invalid in netlink -- leave out
  *	the attribute for this on CONNECT commands.
  */
-__diag_push()
-__diag_ignore(CLANG, 10, "-Wduplicate-enum", "Some entries are duplicated")
 enum nl80211_auth_type {
 	NL80211_AUTHTYPE_OPEN_SYSTEM,
 	NL80211_AUTHTYPE_SHARED_KEY,
@@ -4725,9 +4723,8 @@ enum nl80211_auth_type {
 	/* keep last */
 	__NL80211_AUTHTYPE_NUM,
 	NL80211_AUTHTYPE_MAX = __NL80211_AUTHTYPE_NUM - 1,
-	NL80211_AUTHTYPE_AUTOMATIC
+	NL80211_AUTHTYPE_AUTOMATIC = __NL80211_AUTHTYPE_NUM
 };
-__diag_pop()
 
 /**
  * enum nl80211_key_type - Key Type
-- 
