From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Sat, 18 Nov 2017 19:14:01 +0100
Subject: [PATCH] {MAYBE UPS} drivers/gpu/drm/amd/display/dc/calcs: ignore
 -Wdouble-promotion

clang reports issues
---
 drivers/gpu/drm/amd/display/dc/dml/calcs/dcn_calc_math.c    | 4 ++--
 .../drm/amd/display/dc/dml/dcn20/display_mode_vba_20v2.c    | 2 +-
 .../gpu/drm/amd/display/dc/dml/dcn21/display_mode_vba_21.c  | 6 +++---
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/amd/display/dc/dml/calcs/dcn_calc_math.c b/drivers/gpu/drm/amd/display/dc/dml/calcs/dcn_calc_math.c
index 07d18e78de49..61e77cf6f333 100644
--- a/drivers/gpu/drm/amd/display/dc/dml/calcs/dcn_calc_math.c
+++ b/drivers/gpu/drm/amd/display/dc/dml/calcs/dcn_calc_math.c
@@ -90,7 +90,7 @@ float dcn_bw_ceil2(const float arg, const float significance)
 	float flr = dcn_bw_floor2(arg, significance);
 	if (significance == 0)
 		return 0;
-	return flr + 0.00001 >= arg ? arg : flr + significance;
+	return flr + 0.00001f >= arg ? arg : flr + significance;
 }
 
 float dcn_bw_max3(float v1, float v2, float v3)
@@ -140,7 +140,7 @@ float dcn_bw_log(float a, float b)
 
 	a = ((-1.0f / 3) * a + 2) * a - 2.0f / 3;
 
-	if (b > 2.00001 || b < 1.99999)
+	if (b > 2.00001f || b < 1.99999f)
 		return (a + log_2) / dcn_bw_log(b, 2);
 	else
 		return (a + log_2);
diff --git a/drivers/gpu/drm/amd/display/dc/dml/dcn20/display_mode_vba_20v2.c b/drivers/gpu/drm/amd/display/dc/dml/dcn20/display_mode_vba_20v2.c
index 63bbdf8b8678..d9b2687d8f03 100644
--- a/drivers/gpu/drm/amd/display/dc/dml/dcn20/display_mode_vba_20v2.c
+++ b/drivers/gpu/drm/amd/display/dc/dml/dcn20/display_mode_vba_20v2.c
@@ -2628,7 +2628,7 @@ static void dml20v2_DISPCLKDPPCLKDCFCLKDeepSleepPrefetchParametersWatermarksAndP
 		if (!((k == PlaneWithMinActiveDRAMClockChangeMargin) && (mode_lib->vba.BlendingAndTiming[k] == k))
 				&& !(mode_lib->vba.BlendingAndTiming[k] == PlaneWithMinActiveDRAMClockChangeMargin)
 				&& mode_lib->vba.ActiveDRAMClockChangeLatencyMargin[k]
-						< SecondMinActiveDRAMClockChangeMarginOneDisplayInVBLank) {
+						< (double)SecondMinActiveDRAMClockChangeMarginOneDisplayInVBLank) {
 			SecondMinActiveDRAMClockChangeMarginOneDisplayInVBLank =
 					mode_lib->vba.ActiveDRAMClockChangeLatencyMargin[k];
 		}
diff --git a/drivers/gpu/drm/amd/display/dc/dml/dcn21/display_mode_vba_21.c b/drivers/gpu/drm/amd/display/dc/dml/dcn21/display_mode_vba_21.c
index 8a7485e21d53..ed29a4eecaf6 100644
--- a/drivers/gpu/drm/amd/display/dc/dml/dcn21/display_mode_vba_21.c
+++ b/drivers/gpu/drm/amd/display/dc/dml/dcn21/display_mode_vba_21.c
@@ -5961,7 +5961,7 @@ static void CalculateMetaAndPTETimes(
 						* PixelPTEReqHeightY[k];
 			}
 			dpte_groups_per_row_luma_ub = dml_ceil(
-					(float) dpte_row_width_luma_ub[k] / dpte_group_width_luma,
+					(double) dpte_row_width_luma_ub[k] / dpte_group_width_luma,
 					1);
 			time_per_pte_group_nom_luma[k] = DST_Y_PER_PTE_ROW_NOM_L[k] * HTotal[k]
 					/ PixelClock[k] / dpte_groups_per_row_luma_ub;
@@ -5985,8 +5985,8 @@ static void CalculateMetaAndPTETimes(
 							* PixelPTEReqHeightC[k];
 				}
 				dpte_groups_per_row_chroma_ub = dml_ceil(
-						(float) dpte_row_width_chroma_ub[k]
-								/ dpte_group_width_chroma,
+						(double) (dpte_row_width_chroma_ub[k]
+								/ dpte_group_width_chroma),
 						1);
 				time_per_pte_group_nom_chroma[k] = DST_Y_PER_PTE_ROW_NOM_C[k]
 						* HTotal[k] / PixelClock[k]
-- 
