From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Sat, 4 Jul 2015 11:50:02 +0800
Subject: [PATCH] {PRAGMA} ignore -Wsuggest-attribute=format

---
 drivers/net/wireless/broadcom/brcm80211/brcmfmac/tracepoint.h       | 6 ++++++
 .../wireless/broadcom/brcm80211/brcmsmac/brcms_trace_brcmsmac_msg.h | 6 ++++++
 drivers/net/wireless/intel/iwlwifi/iwl-devtrace-msg.h               | 6 ++++++
 drivers/staging/rdma/hfi1/trace.h                                   | 3 +++
 kernel/panic.c                                                      | 4 ++++
 lib/vsprintf.c                                                      | 3 +++
 6 files changed, 28 insertions(+)

diff --git a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/tracepoint.h b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/tracepoint.h
index 4d7d51f95716..dea7a25ec254 100644
--- a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/tracepoint.h
+++ b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/tracepoint.h
@@ -39,6 +39,8 @@ static inline void trace_ ## name(proto) {}
 
 #define MAX_MSG_LEN		100
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 TRACE_EVENT(brcmf_err,
 	TP_PROTO(const char *func, struct va_format *vaf),
 	TP_ARGS(func, vaf),
@@ -54,7 +56,10 @@ TRACE_EVENT(brcmf_err,
 	),
 	TP_printk("%s: %s", __get_str(func), __get_str(msg))
 );
+#pragma GCC diagnostic pop
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 TRACE_EVENT(brcmf_dbg,
 	TP_PROTO(u32 level, const char *func, struct va_format *vaf),
 	TP_ARGS(level, func, vaf),
@@ -72,6 +77,7 @@ TRACE_EVENT(brcmf_dbg,
 	),
 	TP_printk("%s: %s", __get_str(func), __get_str(msg))
 );
+#pragma GCC diagnostic pop
 
 TRACE_EVENT(brcmf_hexdump,
 	TP_PROTO(void *data, size_t len),
diff --git a/drivers/net/wireless/broadcom/brcm80211/brcmsmac/brcms_trace_brcmsmac_msg.h b/drivers/net/wireless/broadcom/brcm80211/brcmsmac/brcms_trace_brcmsmac_msg.h
index 0e8a69ab909f..2f5e5715eb14 100644
--- a/drivers/net/wireless/broadcom/brcm80211/brcmsmac/brcms_trace_brcmsmac_msg.h
+++ b/drivers/net/wireless/broadcom/brcm80211/brcmsmac/brcms_trace_brcmsmac_msg.h
@@ -24,6 +24,8 @@
 
 #define MAX_MSG_LEN	100
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 DECLARE_EVENT_CLASS(brcms_msg_event,
 	TP_PROTO(struct va_format *vaf),
 	TP_ARGS(vaf),
@@ -37,6 +39,7 @@ DECLARE_EVENT_CLASS(brcms_msg_event,
 	),
 	TP_printk("%s", __get_str(msg))
 );
+#pragma GCC diagnostic pop
 
 DEFINE_EVENT(brcms_msg_event, brcms_info,
 	TP_PROTO(struct va_format *vaf),
@@ -58,6 +61,8 @@ DEFINE_EVENT(brcms_msg_event, brcms_crit,
 	TP_ARGS(vaf)
 );
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 TRACE_EVENT(brcms_dbg,
 	TP_PROTO(u32 level, const char *func, struct va_format *vaf),
 	TP_ARGS(level, func, vaf),
@@ -75,6 +80,7 @@ TRACE_EVENT(brcms_dbg,
 	),
 	TP_printk("%s: %s", __get_str(func), __get_str(msg))
 );
+#pragma GCC diagnostic pop
 #endif /* __TRACE_BRCMSMAC_MSG_H */
 
 #ifdef CONFIG_BRCM_TRACING
diff --git a/drivers/net/wireless/intel/iwlwifi/iwl-devtrace-msg.h b/drivers/net/wireless/intel/iwlwifi/iwl-devtrace-msg.h
index 5dfc9295a7e0..ebf1fd43e63f 100644
--- a/drivers/net/wireless/intel/iwlwifi/iwl-devtrace-msg.h
+++ b/drivers/net/wireless/intel/iwlwifi/iwl-devtrace-msg.h
@@ -34,6 +34,8 @@
 
 #define MAX_MSG_LEN	110
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 DECLARE_EVENT_CLASS(iwlwifi_msg_event,
 	TP_PROTO(struct va_format *vaf),
 	TP_ARGS(vaf),
@@ -47,6 +49,7 @@ DECLARE_EVENT_CLASS(iwlwifi_msg_event,
 	),
 	TP_printk("%s", __get_str(msg))
 );
+#pragma GCC diagnostic pop
 
 DEFINE_EVENT(iwlwifi_msg_event, iwlwifi_err,
 	TP_PROTO(struct va_format *vaf),
@@ -68,6 +71,8 @@ DEFINE_EVENT(iwlwifi_msg_event, iwlwifi_crit,
 	TP_ARGS(vaf)
 );
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 TRACE_EVENT(iwlwifi_dbg,
 	TP_PROTO(u32 level, bool in_interrupt, const char *function,
 		 struct va_format *vaf),
@@ -88,6 +93,7 @@ TRACE_EVENT(iwlwifi_dbg,
 	),
 	TP_printk("%s", __get_str(msg))
 );
+#pragma GCC diagnostic pop
 #endif /* __IWLWIFI_DEVICE_TRACE_MSG */
 
 #undef TRACE_INCLUDE_PATH
diff --git a/drivers/staging/rdma/hfi1/trace.h b/drivers/staging/rdma/hfi1/trace.h
index 86c12ebfd4f0..dcf8332f6dcd 100644
--- a/drivers/staging/rdma/hfi1/trace.h
+++ b/drivers/staging/rdma/hfi1/trace.h
@@ -1344,6 +1344,8 @@ TRACE_EVENT(hfi1_interrupt,
 
 #define MAX_MSG_LEN 512
 
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 DECLARE_EVENT_CLASS(hfi1_trace_template,
 	TP_PROTO(const char *function, struct va_format *vaf),
 	TP_ARGS(function, vaf),
@@ -1361,6 +1363,7 @@ DECLARE_EVENT_CLASS(hfi1_trace_template,
 		  __get_str(function),
 		  __get_str(msg))
 );
+#pragma GCC diagnostic pop
 
 /*
  * It may be nice to macroize the __hfi1_trace but the va_* stuff requires an
diff --git a/kernel/panic.c b/kernel/panic.c
index d96469de72dc..d9cebcc9de81 100644
--- a/kernel/panic.c
+++ b/kernel/panic.c
@@ -455,6 +455,9 @@ struct slowpath_args {
 	va_list args;
 };
 
+/* Ignore gcc warning about missing format attribute */
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 static void warn_slowpath_common(const char *file, int line, void *caller,
 				 unsigned taint, struct slowpath_args *args)
 {
@@ -484,6 +487,7 @@ static void warn_slowpath_common(const char *file, int line, void *caller,
 	/* Just a warning, don't kill lockdep. */
 	add_taint(taint, LOCKDEP_STILL_OK);
 }
+#pragma GCC diagnostic pop
 
 void warn_slowpath_fmt(const char *file, int line, const char *fmt, ...)
 {
diff --git a/lib/vsprintf.c b/lib/vsprintf.c
index f44e178e6ede..f089a4008a3f 100644
--- a/lib/vsprintf.c
+++ b/lib/vsprintf.c
@@ -1584,8 +1584,11 @@ char *pointer(const char *fmt, char *buf, char *end, void *ptr,
 			va_list va;
 
 			va_copy(va, *((struct va_format *)ptr)->va);
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
 			buf += vsnprintf(buf, end > buf ? end - buf : 0,
 					 ((struct va_format *)ptr)->fmt, va);
+#pragma GCC diagnostic pop
 			va_end(va);
 			return buf;
 		}
-- 
