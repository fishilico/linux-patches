From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Sun, 28 Jun 2015 15:24:06 +0800
Subject: [PATCH] {PRINTF} Add many printf format attributes

---
 arch/x86/boot/tools/build.c                       |  3 ++-
 drivers/acpi/acpica/acutils.h                     |  6 +++---
 drivers/acpi/acpica/nsrepair2.c                   |  2 +-
 drivers/acpi/acpica/utdebug.c                     |  2 +-
 drivers/ata/libata-eh.c                           |  5 +++--
 drivers/base/core.c                               |  2 +-
 drivers/base/cpu.c                                |  2 +-
 drivers/clk/clkdev.c                              |  7 ++++---
 drivers/iio/industrialio-trigger.c                |  3 ++-
 drivers/isdn/capi/capiutil.c                      |  4 ++--
 drivers/isdn/hisax/fsm.h                          |  2 +-
 drivers/isdn/hisax/hisax.h                        |  2 +-
 drivers/isdn/hisax/hisax_isac.c                   |  2 +-
 drivers/isdn/hisax/isdnl1.c                       |  2 +-
 drivers/isdn/hisax/isdnl2.c                       |  2 +-
 drivers/isdn/hisax/tei.c                          |  6 +++---
 drivers/isdn/hysdn/hysdn_boot.c                   |  4 ++--
 drivers/isdn/hysdn/hysdn_defs.h                   |  3 ++-
 drivers/isdn/hysdn/hysdn_procconf.c               | 12 +++++++-----
 drivers/isdn/hysdn/hysdn_proclog.c                |  2 +-
 drivers/isdn/hysdn/hysdn_sched.c                  |  2 +-
 drivers/md/bcache/bset.h                          |  5 +++--
 drivers/pnp/interface.c                           |  2 +-
 drivers/scsi/BusLogic.c                           |  6 +++---
 drivers/scsi/esas2r/esas2r_log.c                  |  8 ++++----
 drivers/staging/fbtft/fb_agm1264k-fl.c            |  2 +-
 drivers/staging/fbtft/fb_ra8875.c                 |  2 +-
 drivers/staging/fbtft/fbtft-io.c                  | 12 ++++++------
 drivers/staging/fbtft/fbtft.h                     |  2 +-
 drivers/staging/fbtft/fbtft_device.c              |  2 +-
 drivers/staging/lustre/lustre/include/lu_object.h |  4 ++--
 drivers/xen/xenbus/xenbus_client.c                | 10 ++++++----
 include/acpi/acpiosxf.h                           |  3 ++-
 include/linux/iio/iio.h                           |  2 +-
 include/linux/iio/trigger_consumer.h              |  2 +-
 include/linux/trace_events.h                      |  3 ++-
 kernel/audit.c                                    |  4 ++--
 kernel/trace/trace.c                              |  2 +-
 kernel/trace/trace.h                              |  8 +++++---
 kernel/trace/trace_output.c                       |  6 +++---
 mm/slub.c                                         |  4 ++--
 net/dccp/ccid.c                                   |  3 ++-
 net/dccp/probe.c                                  |  6 +++---
 net/tipc/netlink_compat.c                         |  2 +-
 scripts/mod/modpost.h                             |  6 +++---
 scripts/unifdef.c                                 |  2 +-
 security/tomoyo/common.c                          |  3 ++-
 security/tomoyo/common.h                          |  4 ++--
 sound/soc/soc-dapm.c                              |  3 ++-
 49 files changed, 105 insertions(+), 88 deletions(-)

diff --git a/arch/x86/boot/tools/build.c b/arch/x86/boot/tools/build.c
index d4e6cd4577e5..6cf61035d2af 100644
--- a/arch/x86/boot/tools/build.c
+++ b/arch/x86/boot/tools/build.c
@@ -127,7 +127,8 @@ static u32 partial_crc32(const u8 *s, int len, u32 crc)
 	return crc;
 }
 
-static void die(const char * str, ...)
+static __attribute__ ((format(printf, 1, 2)))
+void die(const char * str, ...)
 {
 	va_list args;
 	va_start(args, str);
diff --git a/drivers/acpi/acpica/acutils.h b/drivers/acpi/acpica/acutils.h
index 745134ade35f..5ea53e016fec 100644
--- a/drivers/acpi/acpica/acutils.h
+++ b/drivers/acpi/acpica/acutils.h
@@ -698,18 +698,18 @@ void acpi_ut_delete_address_lists(void);
 /*
  * utxferror - various error/warning output functions
  */
-void ACPI_INTERNAL_VAR_XFACE
+__printf(5, 6) void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_warning(const char *module_name,
 			   u32 line_number,
 			   char *pathname,
 			   u8 node_flags, const char *format, ...);
 
-void ACPI_INTERNAL_VAR_XFACE
+__printf(5, 6) void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_info(const char *module_name,
 			u32 line_number,
 			char *pathname, u8 node_flags, const char *format, ...);
 
-void ACPI_INTERNAL_VAR_XFACE
+__printf(5, 6) void ACPI_INTERNAL_VAR_XFACE
 acpi_ut_predefined_bios_error(const char *module_name,
 			      u32 line_number,
 			      char *pathname,
diff --git a/drivers/acpi/acpica/nsrepair2.c b/drivers/acpi/acpica/nsrepair2.c
index 06037e044694..a2cef241c4d6 100644
--- a/drivers/acpi/acpica/nsrepair2.c
+++ b/drivers/acpi/acpica/nsrepair2.c
@@ -305,7 +305,7 @@ acpi_ns_repair_FDE(struct acpi_evaluate_info *info,
 			ACPI_WARN_PREDEFINED((AE_INFO,
 					      info->full_pathname,
 					      info->node_flags,
-					      "Incorrect return buffer length %u, expected %u",
+					      "Incorrect return buffer length %u, expected %zu",
 					      return_object->buffer.length,
 					      ACPI_FDE_DWORD_BUFFER_SIZE));
 
diff --git a/drivers/acpi/acpica/utdebug.c b/drivers/acpi/acpica/utdebug.c
index 615a885e2ca3..b109f0b34350 100644
--- a/drivers/acpi/acpica/utdebug.c
+++ b/drivers/acpi/acpica/utdebug.c
@@ -189,7 +189,7 @@ acpi_debug_print(u32 requested_debug_level,
 	 * Display the module name, current line number, thread ID (if requested),
 	 * current procedure nesting level, and the current procedure name
 	 */
-	acpi_os_printf("%9s-%04ld ", module_name, line_number);
+	acpi_os_printf("%9s-%04u ", module_name, line_number);
 
 #ifdef ACPI_APPLICATION
 	/*
diff --git a/drivers/ata/libata-eh.c b/drivers/ata/libata-eh.c
index e4effef0c83f..19d16d2ce5e1 100644
--- a/drivers/ata/libata-eh.c
+++ b/drivers/ata/libata-eh.c
@@ -175,8 +175,9 @@ static void ata_eh_handle_port_resume(struct ata_port *ap)
 { }
 #endif /* CONFIG_PM */
 
-static void __ata_ehi_pushv_desc(struct ata_eh_info *ehi, const char *fmt,
-				 va_list args)
+static __printf(2, 0) void __ata_ehi_pushv_desc(struct ata_eh_info *ehi,
+						const char *fmt,
+						va_list args)
 {
 	ehi->desc_len += vscnprintf(ehi->desc + ehi->desc_len,
 				     ATA_EH_DESC_LEN - ehi->desc_len,
diff --git a/drivers/base/core.c b/drivers/base/core.c
index 12ebd055724c..8a37eef96d3e 100644
--- a/drivers/base/core.c
+++ b/drivers/base/core.c
@@ -2397,7 +2397,7 @@ static void device_create_release(struct device *dev)
 	kfree(dev);
 }
 
-static struct device *
+static __printf(6, 0) struct device *
 device_create_groups_vargs(struct class *class, struct device *parent,
 			   dev_t devt, void *drvdata,
 			   const struct attribute_group **groups,
diff --git a/drivers/base/cpu.c b/drivers/base/cpu.c
index 321cd7b4d817..2724b4d75e74 100644
--- a/drivers/base/cpu.c
+++ b/drivers/base/cpu.c
@@ -396,7 +396,7 @@ static void device_create_release(struct device *dev)
 	kfree(dev);
 }
 
-static struct device *
+static __printf(4, 0) struct device *
 __cpu_device_create(struct device *parent, void *drvdata,
 		    const struct attribute_group **groups,
 		    const char *fmt, va_list args)
diff --git a/drivers/clk/clkdev.c b/drivers/clk/clkdev.c
index 6b2f29df3f70..a3a6afddffe3 100644
--- a/drivers/clk/clkdev.c
+++ b/drivers/clk/clkdev.c
@@ -250,7 +250,7 @@ struct clk_lookup_alloc {
 	char	con_id[MAX_CON_ID];
 };
 
-static struct clk_lookup * __ref
+static __printf(3, 0) struct clk_lookup * __ref
 vclkdev_alloc(struct clk_hw *hw, const char *con_id, const char *dev_fmt,
 	va_list ap)
 {
@@ -274,7 +274,7 @@ vclkdev_alloc(struct clk_hw *hw, const char *con_id, const char *dev_fmt,
 	return &cla->cl;
 }
 
-static struct clk_lookup *
+static __printf(3, 0) struct clk_lookup *
 vclkdev_create(struct clk_hw *hw, const char *con_id, const char *dev_fmt,
 	va_list ap)
 {
@@ -390,7 +390,8 @@ void clkdev_drop(struct clk_lookup *cl)
 }
 EXPORT_SYMBOL(clkdev_drop);
 
-static struct clk_lookup *__clk_register_clkdev(struct clk_hw *hw,
+static __printf(3, 4) struct clk_lookup *
+__clk_register_clkdev(struct clk_hw *hw,
 						const char *con_id,
 						const char *dev_id, ...)
 {
diff --git a/drivers/iio/industrialio-trigger.c b/drivers/iio/industrialio-trigger.c
index 4061fed93f1f..5bb91bd7a943 100644
--- a/drivers/iio/industrialio-trigger.c
+++ b/drivers/iio/industrialio-trigger.c
@@ -516,7 +516,8 @@ static void iio_trig_subirqunmask(struct irq_data *d)
 	trig->subirqs[d->irq - trig->subirq_base].enabled = true;
 }
 
-static struct iio_trigger *viio_trigger_alloc(const char *fmt, va_list vargs)
+static __printf(1, 0)
+struct iio_trigger *viio_trigger_alloc(const char *fmt, va_list vargs)
 {
 	struct iio_trigger *trig;
 	int i;
diff --git a/drivers/isdn/capi/capiutil.c b/drivers/isdn/capi/capiutil.c
index 9846d82eb097..1b9f41563d47 100644
--- a/drivers/isdn/capi/capiutil.c
+++ b/drivers/isdn/capi/capiutil.c
@@ -566,7 +566,7 @@ static char *pnames[] =
 #include <stdarg.h>
 
 /*-------------------------------------------------------*/
-static _cdebbuf *bufprint(_cdebbuf *cdb, char *fmt, ...)
+static __printf(2, 3) _cdebbuf *bufprint(_cdebbuf *cdb, char *fmt, ...)
 {
 	va_list f;
 	size_t n, r;
@@ -672,7 +672,7 @@ static _cdebbuf *protocol_message_2_pars(_cdebbuf *cdb, _cmsg *cmsg, int level)
 			cmsg->l += 2;
 			break;
 		case _CDWORD:
-			cdb = bufprint(cdb, "%-*s = 0x%lx\n", slen, NAME, *(u32 *) (cmsg->m + cmsg->l));
+			cdb = bufprint(cdb, "%-*s = 0x%x\n", slen, NAME, *(u32 *) (cmsg->m + cmsg->l));
 			cmsg->l += 4;
 			break;
 		case _CSTRUCT:
diff --git a/drivers/isdn/hisax/fsm.h b/drivers/isdn/hisax/fsm.h
index 8c7385619a46..04bb1b3512e3 100644
--- a/drivers/isdn/hisax/fsm.h
+++ b/drivers/isdn/hisax/fsm.h
@@ -32,7 +32,7 @@ struct FsmInst {
 	int debug;
 	void *userdata;
 	int userint;
-	void (*printdebug) (struct FsmInst *, char *, ...);
+	void (__printf(2, 3) *printdebug) (struct FsmInst *, char *, ...);
 };
 
 struct FsmNode {
diff --git a/drivers/isdn/hisax/hisax.h b/drivers/isdn/hisax/hisax.h
index 338d0408b377..01deefb7e515 100644
--- a/drivers/isdn/hisax/hisax.h
+++ b/drivers/isdn/hisax/hisax.h
@@ -179,7 +179,7 @@ struct FsmInst {
 	int debug;
 	void *userdata;
 	int userint;
-	void (*printdebug) (struct FsmInst *, char *, ...);
+	void (__printf(2, 3) *printdebug) (struct FsmInst *, char *, ...);
 };
 
 struct FsmNode {
diff --git a/drivers/isdn/hisax/hisax_isac.c b/drivers/isdn/hisax/hisax_isac.c
index 0f36375478c5..4639b3d0d04d 100644
--- a/drivers/isdn/hisax/hisax_isac.c
+++ b/drivers/isdn/hisax/hisax_isac.c
@@ -428,7 +428,7 @@ static struct FsmNode L1FnList[] __initdata =
 	{ST_L1_F8,            EV_PH_DC,             l1_go_f3pdown},
 };
 
-static void l1m_debug(struct FsmInst *fi, char *fmt, ...)
+static __printf(2, 3) void l1m_debug(struct FsmInst *fi, char *fmt, ...)
 {
 	va_list args;
 	char buf[256];
diff --git a/drivers/isdn/hisax/isdnl1.c b/drivers/isdn/hisax/isdnl1.c
index a560842c0e48..b52da087bb94 100644
--- a/drivers/isdn/hisax/isdnl1.c
+++ b/drivers/isdn/hisax/isdnl1.c
@@ -138,7 +138,7 @@ debugl1(struct IsdnCardState *cs, char *fmt, ...)
 	va_end(args);
 }
 
-static void
+static __printf(2, 3) void
 l1m_debug(struct FsmInst *fi, char *fmt, ...)
 {
 	va_list args;
diff --git a/drivers/isdn/hisax/isdnl2.c b/drivers/isdn/hisax/isdnl2.c
index 1a40ed04cb52..5b44b47a26d6 100644
--- a/drivers/isdn/hisax/isdnl2.c
+++ b/drivers/isdn/hisax/isdnl2.c
@@ -1756,7 +1756,7 @@ releasestack_isdnl2(struct PStack *st)
 	ReleaseWin(&st->l2);
 }
 
-static void
+static __printf(2, 3) void
 l2m_debug(struct FsmInst *fi, char *fmt, ...)
 {
 	va_list args;
diff --git a/drivers/isdn/hisax/tei.c b/drivers/isdn/hisax/tei.c
index 9195f9fd628f..bf4928dc69fc 100644
--- a/drivers/isdn/hisax/tei.c
+++ b/drivers/isdn/hisax/tei.c
@@ -320,7 +320,7 @@ tei_l1l2(struct PStack *st, int pr, void *arg)
 	if (pr == (PH_DATA | INDICATION)) {
 		if (skb->len < 3) {
 			st->ma.tei_m.printdebug(&st->ma.tei_m,
-						"short mgr frame %ld/3", skb->len);
+						"short mgr frame %u/3", skb->len);
 		} else if ((skb->data[0] != ((TEI_SAPI << 2) | 2)) ||
 			   (skb->data[1] != ((GROUP_TEI << 1) | 1))) {
 			st->ma.tei_m.printdebug(&st->ma.tei_m,
@@ -333,7 +333,7 @@ tei_l1l2(struct PStack *st, int pr, void *arg)
 			skb_pull(skb, 3);
 			if (skb->len < 5) {
 				st->ma.tei_m.printdebug(&st->ma.tei_m,
-							"short mgr frame %ld/5", skb->len);
+							"short mgr frame %u/5", skb->len);
 			} else if (skb->data[0] != TEI_ENTITY_ID) {
 				/* wrong management entity identifier, ignore */
 				st->ma.tei_m.printdebug(&st->ma.tei_m,
@@ -390,7 +390,7 @@ tei_l2tei(struct PStack *st, int pr, void *arg)
 	}
 }
 
-static void
+static __printf(2, 3) void
 tei_debug(struct FsmInst *fi, char *fmt, ...)
 {
 	va_list args;
diff --git a/drivers/isdn/hysdn/hysdn_boot.c b/drivers/isdn/hysdn/hysdn_boot.c
index 4a0425378f37..bc47b649cb3a 100644
--- a/drivers/isdn/hysdn/hysdn_boot.c
+++ b/drivers/isdn/hysdn/hysdn_boot.c
@@ -153,7 +153,7 @@ pof_handle_data(hysdn_card *card, int datlen)
 
 	default:
 		if (card->debug_flags & LOG_POF_RECORD)
-			hysdn_addlog(card, "POF got data(id=0x%lx) len=%d offs=0x%lx", boot->pof_recid,
+			hysdn_addlog(card, "POF got data(id=0x%x) len=%d offs=0x%lx", boot->pof_recid,
 				     datlen, boot->pof_recoffset);
 
 		break;	/* simply skip record */
@@ -215,7 +215,7 @@ pof_write_buffer(hysdn_card *card, int datlen)
 		boot->pof_recoffset = 0;	/* no starting offset */
 
 		if (card->debug_flags & LOG_POF_RECORD)
-			hysdn_addlog(card, "POF: got record id=0x%lx length=%ld ",
+			hysdn_addlog(card, "POF: got record id=0x%x length=%ld ",
 				     boot->pof_recid, boot->pof_reclen);
 
 		boot->pof_state = POF_READ_TAG_DATA;	/* now start with tag data */
diff --git a/drivers/isdn/hysdn/hysdn_defs.h b/drivers/isdn/hysdn/hysdn_defs.h
index cdac46a21692..6d5c4deba042 100644
--- a/drivers/isdn/hysdn/hysdn_defs.h
+++ b/drivers/isdn/hysdn/hysdn_defs.h
@@ -235,7 +235,8 @@ extern void hysdn_procconf_release(void);	/* deinit proc config filesys */
 /* hysdn_proclog.c */
 extern int hysdn_proclog_init(hysdn_card *);	/* init proc log entry */
 extern void hysdn_proclog_release(hysdn_card *);	/* deinit proc log entry */
-extern void hysdn_addlog(hysdn_card *, char *, ...);	/* output data to log */
+extern __printf(2, 3)
+void hysdn_addlog(hysdn_card *, const char *, ...);	/* output data to log */
 extern void hysdn_card_errlog(hysdn_card *, tErrLogEntry *, int);	/* output card log */
 
 /* boardergo.c */
diff --git a/drivers/isdn/hysdn/hysdn_procconf.c b/drivers/isdn/hysdn/hysdn_procconf.c
index 73079213ec94..62306515bc1f 100644
--- a/drivers/isdn/hysdn/hysdn_procconf.c
+++ b/drivers/isdn/hysdn/hysdn_procconf.c
@@ -188,7 +188,7 @@ hysdn_conf_write(struct file *file, const char __user *buf, size_t count, loff_t
 				cnf->buf_size += count;		/* add chars to string */
 				if (cnf->buf_size >= CONF_LINE_LEN - 1) {
 					if (cnf->card->debug_flags & LOG_CNF_MISC)
-						hysdn_addlog(cnf->card, "cnf line too long %d chars pos %d", cnf->buf_size, count);
+						hysdn_addlog(cnf->card, "cnf line too long %d chars pos %zu", cnf->buf_size, count);
 					return (-ERR_CONF_LONG);
 				}
 			}	/* not delimited */
@@ -236,8 +236,9 @@ hysdn_conf_open(struct inode *ino, struct file *filep)
 	mutex_lock(&hysdn_conf_mutex);
 	card = PDE_DATA(ino);
 	if (card->debug_flags & (LOG_PROC_OPEN | LOG_PROC_ALL))
-		hysdn_addlog(card, "config open for uid=%d gid=%d mode=0x%x",
-			     filep->f_cred->fsuid, filep->f_cred->fsgid,
+		hysdn_addlog(card, "config open for uid=%u gid=%u mode=0x%x",
+			     from_kuid(&init_user_ns, filep->f_cred->fsuid),
+			     from_kgid(&init_user_ns, filep->f_cred->fsgid),
 			     filep->f_mode);
 
 	if ((filep->f_mode & (FMODE_READ | FMODE_WRITE)) == FMODE_WRITE) {
@@ -310,8 +311,9 @@ hysdn_conf_close(struct inode *ino, struct file *filep)
 	mutex_lock(&hysdn_conf_mutex);
 	card = PDE_DATA(ino);
 	if (card->debug_flags & (LOG_PROC_OPEN | LOG_PROC_ALL))
-		hysdn_addlog(card, "config close for uid=%d gid=%d mode=0x%x",
-			     filep->f_cred->fsuid, filep->f_cred->fsgid,
+		hysdn_addlog(card, "config close for uid=%u gid=%u mode=0x%x",
+			     from_kuid(&init_user_ns, filep->f_cred->fsuid),
+			     from_kgid(&init_user_ns, filep->f_cred->fsgid),
 			     filep->f_mode);
 
 	if ((filep->f_mode & (FMODE_READ | FMODE_WRITE)) == FMODE_WRITE) {
diff --git a/drivers/isdn/hysdn/hysdn_proclog.c b/drivers/isdn/hysdn/hysdn_proclog.c
index aaca0b3d662e..9c3996077089 100644
--- a/drivers/isdn/hysdn/hysdn_proclog.c
+++ b/drivers/isdn/hysdn/hysdn_proclog.c
@@ -65,7 +65,7 @@ hysdn_card_errlog(hysdn_card *card, tErrLogEntry *logp, int maxsize)
 /* Log function using format specifiers for output */
 /***************************************************/
 void
-hysdn_addlog(hysdn_card *card, char *fmt, ...)
+hysdn_addlog(hysdn_card *card, const char *fmt, ...)
 {
 	struct procdata *pd = card->proclog;
 	char *cp;
diff --git a/drivers/isdn/hysdn/hysdn_sched.c b/drivers/isdn/hysdn/hysdn_sched.c
index 31d7c1415543..63da693c6822 100644
--- a/drivers/isdn/hysdn/hysdn_sched.c
+++ b/drivers/isdn/hysdn/hysdn_sched.c
@@ -153,7 +153,7 @@ hysdn_tx_cfgline(hysdn_card *card, unsigned char *line, unsigned short chan)
 	unsigned long flags;
 
 	if (card->debug_flags & LOG_SCHED_ASYN)
-		hysdn_addlog(card, "async tx-cfg chan=%d len=%d", chan, strlen(line) + 1);
+		hysdn_addlog(card, "async tx-cfg chan=%d len=%zu", chan, strlen(line) + 1);
 
 	while (card->async_busy) {
 
diff --git a/drivers/md/bcache/bset.h b/drivers/md/bcache/bset.h
index fa506c1aa524..5c3effeddf50 100644
--- a/drivers/md/bcache/bset.h
+++ b/drivers/md/bcache/bset.h
@@ -531,14 +531,15 @@ int __bch_keylist_realloc(struct keylist *, unsigned);
 #ifdef CONFIG_BCACHE_DEBUG
 
 int __bch_count_data(struct btree_keys *);
-void __bch_check_keys(struct btree_keys *, const char *, ...);
+__printf(2, 3) void __bch_check_keys(struct btree_keys *, const char *, ...);
 void bch_dump_bset(struct btree_keys *, struct bset *, unsigned);
 void bch_dump_bucket(struct btree_keys *);
 
 #else
 
 static inline int __bch_count_data(struct btree_keys *b) { return -1; }
-static inline void __bch_check_keys(struct btree_keys *b, const char *fmt, ...) {}
+static __printf(2, 3)
+inline void __bch_check_keys(struct btree_keys *b, const char *fmt, ...) {}
 static inline void bch_dump_bucket(struct btree_keys *b) {}
 void bch_dump_bset(struct btree_keys *, struct bset *, unsigned);
 
diff --git a/drivers/pnp/interface.c b/drivers/pnp/interface.c
index 187e4a1175b0..553fb28c2d7f 100644
--- a/drivers/pnp/interface.c
+++ b/drivers/pnp/interface.c
@@ -33,7 +33,7 @@ struct pnp_info_buffer {
 
 typedef struct pnp_info_buffer pnp_info_buffer_t;
 
-static int pnp_printf(pnp_info_buffer_t * buffer, char *fmt, ...)
+static __printf(2, 3) int pnp_printf(pnp_info_buffer_t * buffer, char *fmt, ...)
 {
 	va_list args;
 	int res;
diff --git a/drivers/scsi/BusLogic.c b/drivers/scsi/BusLogic.c
index 35380a58d3f0..9df4bc8ba8ed 100644
--- a/drivers/scsi/BusLogic.c
+++ b/drivers/scsi/BusLogic.c
@@ -3581,8 +3581,8 @@ Target	Requested Completed  Requested Completed  Requested Completed\n\
   blogic_msg prints Driver Messages.
 */
 
-static void blogic_msg(enum blogic_msglevel msglevel, char *fmt,
-			struct blogic_adapter *adapter, ...)
+static __printf(2, 4) void blogic_msg(enum blogic_msglevel msglevel, char *fmt,
+				      struct blogic_adapter *adapter, ...)
 {
 	static char buf[BLOGIC_LINEBUF_SIZE];
 	static bool begin = true;
@@ -3693,7 +3693,7 @@ static int __init blogic_parseopts(char *options)
 					blogic_probe_options.probe134 = true;
 					break;
 				default:
-					blogic_err("BusLogic: Invalid Driver Options " "(invalid I/O Address 0x%X)\n", NULL, io_addr);
+					blogic_err("BusLogic: Invalid Driver Options " "(invalid I/O Address 0x%lX)\n", NULL, io_addr);
 					return 0;
 				}
 			} else if (blogic_parse(&options, "NoProbeISA"))
diff --git a/drivers/scsi/esas2r/esas2r_log.c b/drivers/scsi/esas2r/esas2r_log.c
index 65fdf22b0ba9..3349670b09de 100644
--- a/drivers/scsi/esas2r/esas2r_log.c
+++ b/drivers/scsi/esas2r/esas2r_log.c
@@ -113,10 +113,10 @@ static const char *translate_esas2r_event_level_to_kernel(const long level)
  *
  * @return 0 on success, or -1 if an error occurred.
  */
-static int esas2r_log_master(const long level,
-			     const struct device *dev,
-			     const char *format,
-			     va_list args)
+static __printf(3, 0) int esas2r_log_master(const long level,
+					    const struct device *dev,
+					    const char *format,
+					    va_list args)
 {
 	if (level <= event_log_level) {
 		unsigned long flags = 0;
diff --git a/drivers/staging/fbtft/fb_agm1264k-fl.c b/drivers/staging/fbtft/fb_agm1264k-fl.c
index 456a8dd65caf..e437fa359f11 100644
--- a/drivers/staging/fbtft/fb_agm1264k-fl.c
+++ b/drivers/staging/fbtft/fb_agm1264k-fl.c
@@ -415,7 +415,7 @@ static int write_vmem(struct fbtft_par *par, size_t offset, size_t len)
 static int write(struct fbtft_par *par, void *buf, size_t len)
 {
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-			  "%s(len=%d): ", __func__, len);
+			  "%s(len=%zu): ", __func__, len);
 
 	gpio_set_value(par->RW, 0); /* set write mode */
 
diff --git a/drivers/staging/fbtft/fb_ra8875.c b/drivers/staging/fbtft/fb_ra8875.c
index a899614ce829..604869624d41 100644
--- a/drivers/staging/fbtft/fb_ra8875.c
+++ b/drivers/staging/fbtft/fb_ra8875.c
@@ -33,7 +33,7 @@ static int write_spi(struct fbtft_par *par, void *buf, size_t len)
 	struct spi_message m;
 
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-			  "%s(len=%d): ", __func__, len);
+			  "%s(len=%zu): ", __func__, len);
 
 	if (!par->spi) {
 		dev_err(par->info->device,
diff --git a/drivers/staging/fbtft/fbtft-io.c b/drivers/staging/fbtft/fbtft-io.c
index f4a591919f62..0e9220bd2fe9 100644
--- a/drivers/staging/fbtft/fbtft-io.c
+++ b/drivers/staging/fbtft/fbtft-io.c
@@ -14,7 +14,7 @@ int fbtft_write_spi(struct fbtft_par *par, void *buf, size_t len)
 	struct spi_message m;
 
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-		"%s(len=%d): ", __func__, len);
+		"%s(len=%zu): ", __func__, len);
 
 	if (!par->spi) {
 		dev_err(par->info->device,
@@ -47,7 +47,7 @@ int fbtft_write_spi_emulate_9(struct fbtft_par *par, void *buf, size_t len)
 	u64 val, dc, tmp;
 
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-		"%s(len=%d): ", __func__, len);
+		"%s(len=%zu): ", __func__, len);
 
 	if (!par->extra) {
 		dev_err(par->info->device, "%s: error: par->extra is NULL\n",
@@ -109,14 +109,14 @@ int fbtft_read_spi(struct fbtft_par *par, void *buf, size_t len)
 		txbuf[0] = par->startbyte | 0x3;
 		t.tx_buf = txbuf;
 		fbtft_par_dbg_hex(DEBUG_READ, par, par->info->device, u8,
-			txbuf, len, "%s(len=%d) txbuf => ", __func__, len);
+			txbuf, len, "%s(len=%zu) txbuf => ", __func__, len);
 	}
 
 	spi_message_init(&m);
 	spi_message_add_tail(&t, &m);
 	ret = spi_sync(par->spi, &m);
 	fbtft_par_dbg_hex(DEBUG_READ, par, par->info->device, u8, buf, len,
-		"%s(len=%d) buf <= ", __func__, len);
+		"%s(len=%zu) buf <= ", __func__, len);
 
 	return ret;
 }
@@ -135,7 +135,7 @@ int fbtft_write_gpio8_wr(struct fbtft_par *par, void *buf, size_t len)
 #endif
 
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-		"%s(len=%d): ", __func__, len);
+		"%s(len=%zu): ", __func__, len);
 
 	while (len--) {
 		data = *(u8 *)buf;
@@ -185,7 +185,7 @@ int fbtft_write_gpio16_wr(struct fbtft_par *par, void *buf, size_t len)
 #endif
 
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-		"%s(len=%d): ", __func__, len);
+		"%s(len=%zu): ", __func__, len);
 
 	while (len) {
 		data = *(u16 *)buf;
diff --git a/drivers/staging/fbtft/fbtft.h b/drivers/staging/fbtft/fbtft.h
index 488ab788138e..80c5f3f5e783 100644
--- a/drivers/staging/fbtft/fbtft.h
+++ b/drivers/staging/fbtft/fbtft.h
@@ -250,7 +250,7 @@ struct fbtft_par {
 /* fbtft-core.c */
 int fbtft_write_buf_dc(struct fbtft_par *par, void *buf, size_t len, int dc);
 void fbtft_dbg_hex(const struct device *dev, int groupsize,
-		   void *buf, size_t len, const char *fmt, ...);
+		   void *buf, size_t len, const char *fmt, ...) __printf(5, 6);
 struct fb_info *fbtft_framebuffer_alloc(struct fbtft_display *display,
 					struct device *dev,
 					struct fbtft_platform_data *pdata);
diff --git a/drivers/staging/fbtft/fbtft_device.c b/drivers/staging/fbtft/fbtft_device.c
index 0d974738c1c4..c0c90d7701be 100644
--- a/drivers/staging/fbtft/fbtft_device.c
+++ b/drivers/staging/fbtft/fbtft_device.c
@@ -1252,7 +1252,7 @@ static int write_gpio16_wr_slow(struct fbtft_par *par, void *buf, size_t len)
 #endif
 
 	fbtft_par_dbg_hex(DEBUG_WRITE, par, par->info->device, u8, buf, len,
-		"%s(len=%d): ", __func__, len);
+		"%s(len=%zu): ", __func__, len);
 
 	while (len) {
 		data = *(u16 *)buf;
diff --git a/drivers/staging/lustre/lustre/include/lu_object.h b/drivers/staging/lustre/lustre/include/lu_object.h
index 4f213c408cfa..75d0cf8f57e6 100644
--- a/drivers/staging/lustre/lustre/include/lu_object.h
+++ b/drivers/staging/lustre/lustre/include/lu_object.h
@@ -782,8 +782,8 @@ struct lu_object *lu_object_locate(struct lu_object_header *h,
 /**
  * Printer function emitting messages through libcfs_debug_msg().
  */
-int lu_cdebug_printer(const struct lu_env *env,
-		      void *cookie, const char *format, ...);
+__printf(3, 4) int lu_cdebug_printer(const struct lu_env *env,
+				     void *cookie, const char *format, ...);
 
 /**
  * Print object description followed by a user-supplied message.
diff --git a/drivers/xen/xenbus/xenbus_client.c b/drivers/xen/xenbus/xenbus_client.c
index a1c17000129b..2bcef22d22a0 100644
--- a/drivers/xen/xenbus/xenbus_client.c
+++ b/drivers/xen/xenbus/xenbus_client.c
@@ -259,8 +259,9 @@ int xenbus_frontend_closed(struct xenbus_device *dev)
 }
 EXPORT_SYMBOL_GPL(xenbus_frontend_closed);
 
-static void xenbus_va_dev_error(struct xenbus_device *dev, int err,
-				const char *fmt, va_list ap)
+static __printf(3, 0)
+void xenbus_va_dev_error(struct xenbus_device *dev, int err,
+			 const char *fmt, va_list ap)
 {
 	unsigned int len;
 	char *printf_buffer;
@@ -333,8 +334,9 @@ EXPORT_SYMBOL_GPL(xenbus_dev_fatal);
  * Equivalent to xenbus_dev_fatal(dev, err, fmt, args), but helps
  * avoiding recursion within xenbus_switch_state.
  */
-static void xenbus_switch_fatal(struct xenbus_device *dev, int depth, int err,
-				const char *fmt, ...)
+static __printf(4, 5) void xenbus_switch_fatal(struct xenbus_device *dev,
+					       int depth, int err,
+					       const char *fmt, ...)
 {
 	va_list ap;
 
diff --git a/include/acpi/acpiosxf.h b/include/acpi/acpiosxf.h
index c66eb8ffa454..b4bc971b36e3 100644
--- a/include/acpi/acpiosxf.h
+++ b/include/acpi/acpiosxf.h
@@ -341,11 +341,12 @@ acpi_status acpi_os_enter_sleep(u8 sleep_state, u32 rega_value, u32 regb_value);
  * Debug print routines
  */
 #ifndef ACPI_USE_ALTERNATE_PROTOTYPE_acpi_os_printf
+__printf(1, 2)
 void ACPI_INTERNAL_VAR_XFACE acpi_os_printf(const char *format, ...);
 #endif
 
 #ifndef ACPI_USE_ALTERNATE_PROTOTYPE_acpi_os_vprintf
-void acpi_os_vprintf(const char *format, va_list args);
+__printf(1, 0) void acpi_os_vprintf(const char *format, va_list args);
 #endif
 
 #ifndef ACPI_USE_ALTERNATE_PROTOTYPE_acpi_os_redirect_output
diff --git a/include/linux/iio/iio.h b/include/linux/iio/iio.h
index c380daa40c0e..37f62c2f41f1 100644
--- a/include/linux/iio/iio.h
+++ b/include/linux/iio/iio.h
@@ -699,7 +699,7 @@ void iio_device_free(struct iio_dev *indio_dev);
 int devm_iio_device_match(struct device *dev, void *res, void *data);
 struct iio_dev *devm_iio_device_alloc(struct device *dev, int sizeof_priv);
 void devm_iio_device_free(struct device *dev, struct iio_dev *indio_dev);
-struct iio_trigger *devm_iio_trigger_alloc(struct device *dev,
+__printf(2, 3) struct iio_trigger *devm_iio_trigger_alloc(struct device *dev,
 						const char *fmt, ...);
 void devm_iio_trigger_free(struct device *dev, struct iio_trigger *iio_trig);
 
diff --git a/include/linux/iio/trigger_consumer.h b/include/linux/iio/trigger_consumer.h
index c4f8c7409666..6b0e38074444 100644
--- a/include/linux/iio/trigger_consumer.h
+++ b/include/linux/iio/trigger_consumer.h
@@ -41,7 +41,7 @@ struct iio_poll_func {
 };
 
 
-struct iio_poll_func
+__printf(5, 6) struct iio_poll_func
 *iio_alloc_pollfunc(irqreturn_t (*h)(int irq, void *p),
 		    irqreturn_t (*thread)(int irq, void *p),
 		    int type,
diff --git a/include/linux/trace_events.h b/include/linux/trace_events.h
index 2bcb4dc6df1a..64ca17d371da 100644
--- a/include/linux/trace_events.h
+++ b/include/linux/trace_events.h
@@ -162,7 +162,8 @@ void tracing_record_taskinfo_sched_switch(struct task_struct *prev,
 void tracing_record_cmdline(struct task_struct *task);
 void tracing_record_tgid(struct task_struct *task);
 
-int trace_output_call(struct trace_iterator *iter, char *name, char *fmt, ...);
+__printf(3, 4)
+int trace_output_call(struct trace_iterator *iter, char *name, const char *fmt, ...);
 
 struct event_filter;
 
diff --git a/kernel/audit.c b/kernel/audit.c
index be1c28fd4d57..316d96cd2639 100644
--- a/kernel/audit.c
+++ b/kernel/audit.c
@@ -1775,8 +1775,8 @@ static inline int audit_expand(struct audit_buffer *ab, int extra)
  * will be called a second time.  Currently, we assume that a printk
  * can't format message larger than 1024 bytes, so we don't either.
  */
-static void audit_log_vformat(struct audit_buffer *ab, const char *fmt,
-			      va_list args)
+static __printf(2, 0) void audit_log_vformat(struct audit_buffer *ab,
+					     const char *fmt, va_list args)
 {
 	int len, avail;
 	struct sk_buff *skb;
diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 752e5daf0896..cf43802a4cae 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -2952,7 +2952,7 @@ int trace_vbprintk(unsigned long ip, const char *fmt, va_list args)
 }
 EXPORT_SYMBOL_GPL(trace_vbprintk);
 
-static int
+static __printf(3, 0) int
 __trace_array_vprintk(struct ring_buffer *buffer,
 		      unsigned long ip, const char *fmt, va_list args)
 {
diff --git a/kernel/trace/trace.h b/kernel/trace/trace.h
index 401b0639116f..85e7e6821e5f 100644
--- a/kernel/trace/trace.h
+++ b/kernel/trace/trace.h
@@ -756,15 +756,17 @@ extern int trace_selftest_startup_branch(struct tracer *trace,
 
 extern void *head_page(struct trace_array_cpu *data);
 extern unsigned long long ns2usecs(u64 nsec);
-extern int
+extern __printf(2, 0) int
 trace_vbprintk(unsigned long ip, const char *fmt, va_list args);
-extern int
+extern __printf(2, 0) int
 trace_vprintk(unsigned long ip, const char *fmt, va_list args);
-extern int
+extern __printf(3, 0) int
 trace_array_vprintk(struct trace_array *tr,
 		    unsigned long ip, const char *fmt, va_list args);
+extern __printf(3, 4)
 int trace_array_printk(struct trace_array *tr,
 		       unsigned long ip, const char *fmt, ...);
+extern __printf(3, 4)
 int trace_array_printk_buf(struct ring_buffer *buffer,
 			   unsigned long ip, const char *fmt, ...);
 void trace_printk_seq(struct trace_seq *s);
diff --git a/kernel/trace/trace_output.c b/kernel/trace/trace_output.c
index c738e764e2a5..8dc41384bd47 100644
--- a/kernel/trace/trace_output.c
+++ b/kernel/trace/trace_output.c
@@ -296,8 +296,8 @@ int trace_raw_output_prep(struct trace_iterator *iter,
 }
 EXPORT_SYMBOL(trace_raw_output_prep);
 
-static int trace_output_raw(struct trace_iterator *iter, char *name,
-			    char *fmt, va_list ap)
+static __printf(3, 0) int trace_output_raw(struct trace_iterator *iter,
+					   char *name, const char *fmt, va_list ap)
 {
 	struct trace_seq *s = &iter->seq;
 
@@ -307,7 +307,7 @@ static int trace_output_raw(struct trace_iterator *iter, char *name,
 	return trace_handle_return(s);
 }
 
-int trace_output_call(struct trace_iterator *iter, char *name, char *fmt, ...)
+int trace_output_call(struct trace_iterator *iter, char *name, const char *fmt, ...)
 {
 	va_list ap;
 	int ret;
diff --git a/mm/slub.c b/mm/slub.c
index 1efbb8123037..2c4f2467b2ac 100644
--- a/mm/slub.c
+++ b/mm/slub.c
@@ -709,8 +709,8 @@ void object_err(struct kmem_cache *s, struct page *page,
 	print_trailer(s, page, object);
 }
 
-static void slab_err(struct kmem_cache *s, struct page *page,
-			const char *fmt, ...)
+static __printf(3, 4) void slab_err(struct kmem_cache *s, struct page *page,
+				    const char *fmt, ...)
 {
 	va_list args;
 	char buf[100];
diff --git a/net/dccp/ccid.c b/net/dccp/ccid.c
index 90f77d08cc37..f39d321c8af2 100644
--- a/net/dccp/ccid.c
+++ b/net/dccp/ccid.c
@@ -79,7 +79,8 @@ int ccid_getsockopt_builtin_ccids(struct sock *sk, int len,
 	return err;
 }
 
-static struct kmem_cache *ccid_kmem_cache_create(int obj_size, char *slab_name_fmt, const char *fmt,...)
+static __printf(3, 4)
+struct kmem_cache *ccid_kmem_cache_create(int obj_size, char *slab_name_fmt, const char *fmt,...)
 {
 	struct kmem_cache *slab;
 	va_list args;
diff --git a/net/dccp/probe.c b/net/dccp/probe.c
index 3d3fda05b32d..3c4dcc19f38b 100644
--- a/net/dccp/probe.c
+++ b/net/dccp/probe.c
@@ -51,7 +51,7 @@ static struct {
 	struct timespec64 tstart;
 } dccpw;
 
-static void printl(const char *fmt, ...)
+static __printf(1, 2) void printl(const char *fmt, ...)
 {
 	va_list args;
 	int len;
@@ -84,14 +84,14 @@ static int jdccp_sendmsg(struct sock *sk, struct msghdr *msg, size_t size)
 	if (port == 0 || ntohs(inet->inet_dport) == port ||
 	    ntohs(inet->inet_sport) == port) {
 		if (hc)
-			printl("%pI4:%u %pI4:%u %d %d %d %d %u %llu %llu %d\n",
+			printl("%pI4:%u %pI4:%u %zu %d %d %d %u %llu %llu %d\n",
 			       &inet->inet_saddr, ntohs(inet->inet_sport),
 			       &inet->inet_daddr, ntohs(inet->inet_dport), size,
 			       hc->tx_s, hc->tx_rtt, hc->tx_p,
 			       hc->tx_x_calc, hc->tx_x_recv >> 6,
 			       hc->tx_x >> 6, hc->tx_t_ipi);
 		else
-			printl("%pI4:%u %pI4:%u %d\n",
+			printl("%pI4:%u %pI4:%u %zu\n",
 			       &inet->inet_saddr, ntohs(inet->inet_sport),
 			       &inet->inet_daddr, ntohs(inet->inet_dport),
 			       size);
diff --git a/net/tipc/netlink_compat.c b/net/tipc/netlink_compat.c
index e48f0b2c01b9..a2fe5402ef22 100644
--- a/net/tipc/netlink_compat.c
+++ b/net/tipc/netlink_compat.c
@@ -112,7 +112,7 @@ static void tipc_tlv_init(struct sk_buff *skb, u16 type)
 	skb_put(skb, sizeof(struct tlv_desc));
 }
 
-static int tipc_tlv_sprintf(struct sk_buff *skb, const char *fmt, ...)
+static __printf(2, 3) int tipc_tlv_sprintf(struct sk_buff *skb, const char *fmt, ...)
 {
 	int n;
 	u16 len;
diff --git a/scripts/mod/modpost.h b/scripts/mod/modpost.h
index 8453d6ac2f77..7aecdcc1d224 100644
--- a/scripts/mod/modpost.h
+++ b/scripts/mod/modpost.h
@@ -189,6 +189,6 @@ void *grab_file(const char *filename, unsigned long *size);
 char* get_next_line(unsigned long *pos, void *file, unsigned long size);
 void release_file(void *file, unsigned long size);
 
-void fatal(const char *fmt, ...);
-void warn(const char *fmt, ...);
-void merror(const char *fmt, ...);
+void fatal(const char *fmt, ...) __attribute__((format(printf, 1, 2)));
+void warn(const char *fmt, ...) __attribute__((format(printf, 1, 2)));
+void merror(const char *fmt, ...) __attribute__((format(printf, 1, 2)));
diff --git a/scripts/unifdef.c b/scripts/unifdef.c
index 7493c0ee51cc..fba8ff17d8c6 100644
--- a/scripts/unifdef.c
+++ b/scripts/unifdef.c
@@ -1200,7 +1200,7 @@ strlcmp(const char *s, const char *t, size_t n)
 /*
  * Diagnostics.
  */
-static void
+static __attribute__ ((format(printf, 1, 2))) void
 debug(const char *msg, ...)
 {
 	va_list ap;
diff --git a/security/tomoyo/common.c b/security/tomoyo/common.c
index 21691b99e61f..143b037aad40 100644
--- a/security/tomoyo/common.c
+++ b/security/tomoyo/common.c
@@ -193,7 +193,8 @@ const char *tomoyo_yesno(const unsigned int value)
  *
  * Returns nothing.
  */
-static void tomoyo_addprintf(char *buffer, int len, const char *fmt, ...)
+static __printf(3, 4)
+void tomoyo_addprintf(char *buffer, int len, const char *fmt, ...)
 {
 	va_list args;
 	const int pos = strlen(buffer);
diff --git a/security/tomoyo/common.h b/security/tomoyo/common.h
index e4097d7994b1..2f7388b10a14 100644
--- a/security/tomoyo/common.h
+++ b/security/tomoyo/common.h
@@ -944,7 +944,7 @@ bool tomoyo_str_starts(char **src, const char *find);
 char *tomoyo_encode(const char *str);
 char *tomoyo_encode2(const char *str, int str_len);
 char *tomoyo_init_log(struct tomoyo_request_info *r, int len, const char *fmt,
-		      va_list args);
+		      va_list args) __printf(3, 0);
 char *tomoyo_read_token(struct tomoyo_acl_param *param);
 char *tomoyo_realpath_from_path(const struct path *path);
 char *tomoyo_realpath_nofollow(const char *pathname);
@@ -1057,7 +1057,7 @@ void tomoyo_warn_oom(const char *function);
 void tomoyo_write_log(struct tomoyo_request_info *r, const char *fmt, ...)
 	__printf(2, 3);
 void tomoyo_write_log2(struct tomoyo_request_info *r, int len, const char *fmt,
-		       va_list args);
+		       va_list args) __printf(3, 0);
 
 /********** External variable definitions. **********/
 
diff --git a/sound/soc/soc-dapm.c b/sound/soc/soc-dapm.c
index dcef67a9bd48..53022e146c1e 100644
--- a/sound/soc/soc-dapm.c
+++ b/sound/soc/soc-dapm.c
@@ -137,7 +137,8 @@ static void pop_wait(u32 pop_time)
 		schedule_timeout_uninterruptible(msecs_to_jiffies(pop_time));
 }
 
-static void pop_dbg(struct device *dev, u32 pop_time, const char *fmt, ...)
+static __printf(3, 4) void pop_dbg(struct device *dev, u32 pop_time,
+				   const char *fmt, ...)
 {
 	va_list args;
 	char *buf;
-- 
