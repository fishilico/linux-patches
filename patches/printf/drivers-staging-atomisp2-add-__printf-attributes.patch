From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Mon, 8 May 2017 12:22:50 +0200
Subject: [PATCH] {PRINTF} drivers/staging: atomisp2: add __printf attributes

---
 drivers/staging/media/atomisp/pci/atomisp2/atomisp_compat_css20.c   | 6 +++---
 .../pci/atomisp2/css2400/hive_isp_css_include/print_support.h       | 4 ++--
 drivers/staging/media/atomisp/pci/atomisp2/css2400/ia_css_env.h     | 4 ++--
 .../pci/atomisp2/css2400/runtime/debug/interface/ia_css_debug.h     | 2 +-
 .../atomisp/pci/atomisp2/css2400/runtime/debug/src/ia_css_debug.c   | 6 +++---
 drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css.c         | 2 +-
 .../staging/media/atomisp/pci/atomisp2/css2400/sh_css_internal.h    | 6 +++---
 7 files changed, 15 insertions(+), 15 deletions(-)

diff --git a/drivers/staging/media/atomisp/pci/atomisp2/atomisp_compat_css20.c b/drivers/staging/media/atomisp/pci/atomisp2/atomisp_compat_css20.c
index 05897b747349..1346a15d0ce0 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/atomisp_compat_css20.c
+++ b/drivers/staging/media/atomisp/pci/atomisp2/atomisp_compat_css20.c
@@ -178,19 +178,19 @@ static void atomisp_css2_hw_load(hrt_address addr, void *to, uint32_t n)
 	spin_unlock_irqrestore(&mmio_lock, flags);
 }
 
-static int atomisp_css2_dbg_print(const char *fmt, va_list args)
+static __printf(1, 0) int atomisp_css2_dbg_print(const char *fmt, va_list args)
 {
 	vprintk(fmt, args);
 	return 0;
 }
 
-static int atomisp_css2_dbg_ftrace_print(const char *fmt, va_list args)
+static __printf(1, 0) int atomisp_css2_dbg_ftrace_print(const char *fmt, va_list args)
 {
 	ftrace_vprintk(fmt, args);
 	return 0;
 }
 
-static int atomisp_css2_err_print(const char *fmt, va_list args)
+static __printf(1, 0) int atomisp_css2_err_print(const char *fmt, va_list args)
 {
 	vprintk(fmt, args);
 	return 0;
diff --git a/drivers/staging/media/atomisp/pci/atomisp2/css2400/hive_isp_css_include/print_support.h b/drivers/staging/media/atomisp/pci/atomisp2/css2400/hive_isp_css_include/print_support.h
index cfbc222ea0c1..ab8bfd0cad8e 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/css2400/hive_isp_css_include/print_support.h
+++ b/drivers/staging/media/atomisp/pci/atomisp2/css2400/hive_isp_css_include/print_support.h
@@ -22,9 +22,9 @@
 #include <stdio.h>
 #endif
 
-extern int (*sh_css_printf) (const char *fmt, va_list args);
+extern __printf(1, 0) int (*sh_css_printf) (const char *fmt, va_list args);
 /* depends on host supplied print function in ia_css_init() */
-STORAGE_CLASS_INLINE void ia_css_print(const char *fmt, ...)
+STORAGE_CLASS_INLINE __printf(1, 2) void ia_css_print(const char *fmt, ...)
 {
 	va_list ap;
 	if (sh_css_printf) {
diff --git a/drivers/staging/media/atomisp/pci/atomisp2/css2400/ia_css_env.h b/drivers/staging/media/atomisp/pci/atomisp2/css2400/ia_css_env.h
index 1ae9daf0be76..64f365c58e87 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/css2400/ia_css_env.h
+++ b/drivers/staging/media/atomisp/pci/atomisp2/css2400/ia_css_env.h
@@ -74,9 +74,9 @@ struct ia_css_hw_access_env {
 /** Environment with function pointers to print error and debug messages.
  */
 struct ia_css_print_env {
-	int (*debug_print)(const char *fmt, va_list args);
+	__printf(1, 0) int (*debug_print)(const char *fmt, va_list args);
 	/**< Print a debug message. */
-	int (*error_print)(const char *fmt, va_list args);
+	__printf(1, 0) int (*error_print)(const char *fmt, va_list args);
 	/**< Print an error message.*/
 };
 
diff --git a/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/interface/ia_css_debug.h b/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/interface/ia_css_debug.h
index 91c105cc6204..ca610bf9975d 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/interface/ia_css_debug.h
+++ b/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/interface/ia_css_debug.h
@@ -130,7 +130,7 @@ enum ia_css_debug_enable_param_dump {
  * @param[in]	fmt		printf like format string
  * @param[in]	args		arguments for the format string
  */
-STORAGE_CLASS_INLINE void
+STORAGE_CLASS_INLINE __printf(2, 0) void
 ia_css_debug_vdtrace(unsigned int level, const char *fmt, va_list args)
 {
 	if (ia_css_debug_trace_level >= level)
diff --git a/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/src/ia_css_debug.c b/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/src/ia_css_debug.c
index 0fa7cb2423d8..97630b2c2848 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/src/ia_css_debug.c
+++ b/drivers/staging/media/atomisp/pci/atomisp2/css2400/runtime/debug/src/ia_css_debug.c
@@ -2567,7 +2567,7 @@ ia_css_debug_mode_enable_dma_channel(int dma_id,
 	return rc;
 }
 
-void dtrace_dot(const char *fmt, ...)
+static __printf(1, 2) void dtrace_dot(const char *fmt, ...)
 {
 	va_list ap;
 
@@ -2725,7 +2725,7 @@ void ia_css_debug_pipe_graph_dump_epilogue(void)
 {
 
 	if (strlen(ring_buffer) > 0) {
-		dtrace_dot(ring_buffer);
+		dtrace_dot("%s", ring_buffer);
 	}
 
 
@@ -3024,7 +3024,7 @@ ia_css_debug_pipe_graph_dump_sp_raw_copy(
 		out_frame->info.padded_width,
 		out_frame->info.res.height);
 
-	dtrace_dot(ring_buffer);
+	dtrace_dot("%s", ring_buffer);
 
 	dtrace_dot(
 		"\"%s(pipe%d)\"->\"0x%08lx\" "
diff --git a/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css.c b/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css.c
index e882b5596813..6311ce4068c9 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css.c
+++ b/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css.c
@@ -116,7 +116,7 @@ static int thread_alive;
 
 struct sh_css my_css;
 
-int (*sh_css_printf) (const char *fmt, va_list args) = NULL;
+__printf(1, 0) int (*sh_css_printf) (const char *fmt, va_list args) = NULL;
 
 /* modes of work: stream_create and stream_destroy will update the save/restore data
    only when in working mode, not suspend/resume
diff --git a/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css_internal.h b/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css_internal.h
index 5b2b78f96dc5..af77869e3bdd 100644
--- a/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css_internal.h
+++ b/drivers/staging/media/atomisp/pci/atomisp2/css2400/sh_css_internal.h
@@ -959,9 +959,9 @@ struct host_sp_queues {
 #define SIZE_OF_HOST_SP_QUEUES_STRUCT		\
 	(SIZE_OF_QUEUES_ELEMS + SIZE_OF_QUEUES_DESC)
 
-extern int (*sh_css_printf)(const char *fmt, va_list args);
+extern __printf(1, 0) int (*sh_css_printf)(const char *fmt, va_list args);
 
-STORAGE_CLASS_INLINE void
+STORAGE_CLASS_INLINE __printf(1, 2) void
 sh_css_print(const char *fmt, ...)
 {
 	va_list ap;
@@ -973,7 +973,7 @@ sh_css_print(const char *fmt, ...)
 	}
 }
 
-STORAGE_CLASS_INLINE void
+STORAGE_CLASS_INLINE __printf(1, 0) void
 sh_css_vprint(const char *fmt, va_list args)
 {
 	if (sh_css_printf)
-- 
