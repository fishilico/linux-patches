From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Sat, 14 Apr 2018 15:53:18 +0200
Subject: [PATCH] {For LLVMLinux} Make asm goto support optional

clang does not support asm goto yet.

https://bugs.llvm.org/show_bug.cgi?id=9295

This partially reverts commit d0266046ad54 ("x86: Remove
FAST_FEATURE_TESTS")
---
 arch/x86/Makefile                 | 2 +-
 arch/x86/include/asm/cpufeature.h | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/x86/Makefile b/arch/x86/Makefile
index da082c65dbc5..2dbad0a942d7 100644
--- a/arch/x86/Makefile
+++ b/arch/x86/Makefile
@@ -299,7 +299,7 @@ archprepare: checkbin
 checkbin:
 ifndef CONFIG_CC_HAS_ASM_GOTO
 	@echo Compiler lacks asm-goto support.
-	@exit 1
+	@#exit 1
 endif
 ifdef CONFIG_RETPOLINE
 ifeq ($(RETPOLINE_CFLAGS),)
diff --git a/arch/x86/include/asm/cpufeature.h b/arch/x86/include/asm/cpufeature.h
index 1d337c51f7e6..ab86ac3104d7 100644
--- a/arch/x86/include/asm/cpufeature.h
+++ b/arch/x86/include/asm/cpufeature.h
@@ -148,7 +148,7 @@ extern void clear_cpu_cap(struct cpuinfo_x86 *c, unsigned int bit);
  * headers, but clang does not support ASM GOTO and fails the build.
  */
 #ifndef __BPF_TRACING__
-#warning "Compiler lacks ASM_GOTO support. Add -D __BPF_TRACING__ to your compiler arguments"
+/* #warning "Compiler lacks ASM_GOTO support. Add -D __BPF_TRACING__ to your compiler arguments" */
 #endif
 
 #define static_cpu_has(bit)            boot_cpu_has(bit)
-- 
