From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Thu, 19 Mar 2015 16:44:42 +0800
Subject: [PATCH] {NOT UPSTREAMABLE} arch/x86/xen/trace: force building without
 -Werror

because of a non-silentable warning about a comparaison to function pointer
---
 arch/x86/xen/Makefile | 4 ++++
 init/Makefile         | 6 ++++++
 2 files changed, 10 insertions(+)

diff --git a/arch/x86/xen/Makefile b/arch/x86/xen/Makefile
index 084de77a109e..326f9fe3285b 100644
--- a/arch/x86/xen/Makefile
+++ b/arch/x86/xen/Makefile
@@ -13,6 +13,10 @@ nostackp := $(call cc-option, -fno-stack-protector)
 CFLAGS_enlighten_pv.o		:= $(nostackp)
 CFLAGS_mmu_pv.o			:= $(nostackp)
 
+ifdef CONFIG_CC_IS_CLANG
+CFLAGS_trace.o := -Wno-error
+endif
+
 obj-y				+= enlighten.o
 obj-y				+= mmu.o
 obj-y				+= time.o
diff --git a/init/Makefile b/init/Makefile
index d45e967483b2..ed5becf3162e 100644
--- a/init/Makefile
+++ b/init/Makefile
@@ -15,6 +15,12 @@ obj-$(CONFIG_GENERIC_CALIBRATE_DELAY) += calibrate.o
 
 obj-y                          += init_task.o
 
+# clang fails with "error: ordered comparison of function pointers ('initcall_t' (aka 'int (*)(void)') and 'initcall_t') [-Werror]
+# and it is not possible to work around easily
+ifdef CONFIG_CC_IS_CLANG
+CFLAGS_main.o += -Wno-error
+endif
+
 mounts-y			:= do_mounts.o
 mounts-$(CONFIG_BLK_DEV_RAM)	+= do_mounts_rd.o
 mounts-$(CONFIG_BLK_DEV_INITRD)	+= do_mounts_initrd.o
-- 
