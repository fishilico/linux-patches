From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date: Wed, 18 Mar 2015 16:17:32 +0800
Subject: [PATCH] {NOT UPSTREAMABLE} fix harmless uninitialized warnings
 reported by clang

---
 drivers/gpu/drm/amd/powerplay/hwmgr/processpptables.c | 4 ++++
 drivers/gpu/drm/i915/i915_request.c                   | 2 +-
 drivers/gpu/drm/qxl/qxl_draw.c                        | 2 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_execbuf.c               | 1 +
 drivers/iio/common/ssp_sensors/ssp_iio.c              | 3 ++-
 drivers/md/bcache/alloc.c                             | 2 +-
 drivers/media/tuners/tda8290.c                        | 2 ++
 drivers/misc/qcom-coincell.c                          | 4 ++++
 drivers/net/sb1000.c                                  | 2 +-
 drivers/scsi/qla2xxx/qla_mr.c                         | 1 +
 drivers/scsi/qla4xxx/ql4_os.c                         | 2 +-
 drivers/usb/atm/cxacru.c                              | 3 ++-
 fs/ocfs2/localalloc.c                                 | 1 +
 fs/xfs/libxfs/xfs_dir2_node.c                         | 2 ++
 fs/xfs/libxfs/xfs_ialloc.c                            | 2 +-
 fs/xfs/xfs_log_recover.c                              | 2 +-
 include/linux/sunrpc/cache.h                          | 2 +-
 mm/filemap.c                                          | 2 +-
 net/mac80211/mlme.c                                   | 2 +-
 net/mac80211/tx.c                                     | 2 +-
 20 files changed, 30 insertions(+), 13 deletions(-)

diff --git a/drivers/gpu/drm/amd/powerplay/hwmgr/processpptables.c b/drivers/gpu/drm/amd/powerplay/hwmgr/processpptables.c
index 77c14671866c..25690300ada9 100644
--- a/drivers/gpu/drm/amd/powerplay/hwmgr/processpptables.c
+++ b/drivers/gpu/drm/amd/powerplay/hwmgr/processpptables.c
@@ -1074,6 +1074,10 @@ static int init_overdrive_limits(struct pp_hwmgr *hwmgr,
 		result = init_overdrive_limits_V2_1(hwmgr,
 				powerplay_table,
 				(const ATOM_FIRMWARE_INFO_V2_1 *)fw_info);
+	else {
+		/* Should not happen, but silent compiler warnings about unitialized variable */
+		result = 0;
+	}
 
 	return result;
 }
diff --git a/drivers/gpu/drm/i915/i915_request.c b/drivers/gpu/drm/i915/i915_request.c
index be185886e4fc..1f34f22c969b 100644
--- a/drivers/gpu/drm/i915/i915_request.c
+++ b/drivers/gpu/drm/i915/i915_request.c
@@ -1392,7 +1392,7 @@ static unsigned long local_clock_us(unsigned int *cpu)
 
 static bool busywait_stop(unsigned long timeout, unsigned int cpu)
 {
-	unsigned int this_cpu;
+	unsigned int this_cpu = 0; /* clang -Wsometimes-uninitialized false positive, because time_after does a typecheck on local_clock_us return value */
 
 	if (time_after(local_clock_us(&this_cpu), timeout))
 		return true;
diff --git a/drivers/gpu/drm/qxl/qxl_draw.c b/drivers/gpu/drm/qxl/qxl_draw.c
index 5bebf1ea1c5d..42ed3f4ec1af 100644
--- a/drivers/gpu/drm/qxl/qxl_draw.c
+++ b/drivers/gpu/drm/qxl/qxl_draw.c
@@ -136,7 +136,7 @@ void qxl_draw_dirty_fb(struct qxl_device *qdev,
 	int i;
 	int left, right, top, bottom;
 	int width, height;
-	struct qxl_drawable *drawable;
+	struct qxl_drawable *drawable = NULL;
 	struct qxl_rect drawable_rect;
 	struct qxl_rect *rects;
 	int stride = fb->pitches[0];
diff --git a/drivers/gpu/drm/vmwgfx/vmwgfx_execbuf.c b/drivers/gpu/drm/vmwgfx/vmwgfx_execbuf.c
index 73489a45decb..e6e33e9ceec4 100644
--- a/drivers/gpu/drm/vmwgfx/vmwgfx_execbuf.c
+++ b/drivers/gpu/drm/vmwgfx/vmwgfx_execbuf.c
@@ -3780,6 +3780,7 @@ int vmw_execbuf_process(struct drm_file *file_priv,
 		goto out_err;
 
 	vmw_query_bo_switch_commit(dev_priv, sw_context);
+	handle = 0; /* False positive: vmw_user_fence_create() sets the value if the function returns successfully */
 	ret = vmw_execbuf_fence_commands(file_priv, dev_priv, &fence,
 					 (user_fence_rep) ? &handle : NULL);
 	/*
diff --git a/drivers/iio/common/ssp_sensors/ssp_iio.c b/drivers/iio/common/ssp_sensors/ssp_iio.c
index 5336db81ba0a..115818d1714c 100644
--- a/drivers/iio/common/ssp_sensors/ssp_iio.c
+++ b/drivers/iio/common/ssp_sensors/ssp_iio.c
@@ -86,7 +86,8 @@ int ssp_common_process_data(struct iio_dev *indio_dev, void *buf,
 		memcpy(&time, &((char *)buf)[len], SSP_TIME_SIZE);
 		calculated_time =
 			timestamp + (int64_t)le32_to_cpu(time) * 1000000;
-	}
+	} else
+		calculated_time = 0; /* BUG? */
 
 	return iio_push_to_buffers_with_timestamp(indio_dev, spd->buffer,
 						  calculated_time);
diff --git a/drivers/md/bcache/alloc.c b/drivers/md/bcache/alloc.c
index a1df0d95151c..fc45c2a7af4a 100644
--- a/drivers/md/bcache/alloc.c
+++ b/drivers/md/bcache/alloc.c
@@ -328,7 +328,7 @@ static int bch_allocator_thread(void *arg)
 		 * the free list:
 		 */
 		while (1) {
-			long bucket;
+			long bucket = 0; /* False positive: fifo_pop uses if(!fifo_empty()...) which is always true here. Maybe merge the while cond with the call to fifo_pop? */
 
 			if (!fifo_pop(&ca->free_inc, bucket))
 				break;
diff --git a/drivers/media/tuners/tda8290.c b/drivers/media/tuners/tda8290.c
index 98851482c0cc..f6eb52fec98a 100644
--- a/drivers/media/tuners/tda8290.c
+++ b/drivers/media/tuners/tda8290.c
@@ -228,6 +228,8 @@ static void tda8290_set_params(struct dvb_frontend *fe,
 	if (fe->ops.tuner_ops.set_analog_params)
 		fe->ops.tuner_ops.set_analog_params(fe, params);
 
+	adc_sat = 0; /* BUG? After 3 tries, what happens? */
+	agc_stat = 0; /* BUG? */
 	for (i = 0; i < 3; i++) {
 		tuner_i2c_xfer_send_recv(&priv->i2c_props,
 					 &addr_pll_stat, 1, &pll_stat, 1);
diff --git a/drivers/misc/qcom-coincell.c b/drivers/misc/qcom-coincell.c
index 54d4f6ee8888..a4995c3170bc 100644
--- a/drivers/misc/qcom-coincell.c
+++ b/drivers/misc/qcom-coincell.c
@@ -119,6 +119,10 @@ static int qcom_coincell_probe(struct platform_device *pdev)
 			    "can't find 'qcom,vset-millivolts' in DT block");
 			return rc;
 		}
+	} else {
+		/* make clang happy, as rset and vset are never used when !enable */
+		rset = 0;
+		vset = 0;
 	}
 
 	return qcom_coincell_chgr_config(&chgr, rset, vset, enable);
diff --git a/drivers/net/sb1000.c b/drivers/net/sb1000.c
index e88af978f63c..5c9461988aab 100644
--- a/drivers/net/sb1000.c
+++ b/drivers/net/sb1000.c
@@ -738,7 +738,7 @@ sb1000_rx(struct net_device *dev)
 {
 
 #define FRAMESIZE 184
-	unsigned char st[2], buffer[FRAMESIZE], session_id, frame_id;
+	unsigned char st[2] = {0, 0}, buffer[FRAMESIZE], session_id, frame_id;
 	short dlen;
 	int ioaddr, ns;
 	unsigned int skbsize;
diff --git a/drivers/scsi/qla2xxx/qla_mr.c b/drivers/scsi/qla2xxx/qla_mr.c
index cad1fc2a1b28..9aca083b9486 100644
--- a/drivers/scsi/qla2xxx/qla_mr.c
+++ b/drivers/scsi/qla2xxx/qla_mr.c
@@ -2229,6 +2229,7 @@ qlafx00_ioctl_iosb_entry(scsi_qla_host_t *vha, struct req_que *req,
 		if (iocb_job->u.fxiocb.flags & SRB_FXDISC_RSP_DWRD_VALID)
 			iocb_job->u.fxiocb.req_data =
 			    pkt->dataword_r;
+		res = iocb_job->u.fxiocb.result; /* BUG? Not important because qla2x00_fxdisc_sp_done does not use res */
 	} else {
 		bsg_job = sp->u.bsg_job;
 		bsg_reply = bsg_job->reply;
diff --git a/drivers/scsi/qla4xxx/ql4_os.c b/drivers/scsi/qla4xxx/ql4_os.c
index 5504ab11decc..e6588a4537ff 100644
--- a/drivers/scsi/qla4xxx/ql4_os.c
+++ b/drivers/scsi/qla4xxx/ql4_os.c
@@ -5883,7 +5883,7 @@ static void qla4xxx_boot_release(void *data)
 
 static int get_fw_boot_info(struct scsi_qla_host *ha, uint16_t ddb_index[])
 {
-	dma_addr_t buf_dma;
+	dma_addr_t buf_dma = 0; /* False positive: always initialized by dma_alloc_coherent() when used */
 	uint32_t addr, pri_addr, sec_addr;
 	uint32_t offset;
 	uint16_t func_num;
diff --git a/drivers/usb/atm/cxacru.c b/drivers/usb/atm/cxacru.c
index e8a10c8741f7..2f7010b2d90c 100644
--- a/drivers/usb/atm/cxacru.c
+++ b/drivers/usb/atm/cxacru.c
@@ -1112,7 +1112,8 @@ static int cxacru_heavy_init(struct usbatm_data *usbatm_instance,
 			release_firmware(fw);
 			return ret;
 		}
-	}
+	} else
+		bp = NULL; /* not a bug as its uses are always under if(instance->modem_type->boot_rom_patch) */
 
 	cxacru_upload_firmware(instance, fw, bp);
 
diff --git a/fs/ocfs2/localalloc.c b/fs/ocfs2/localalloc.c
index 720e9f94957e..514e0fa3025d 100644
--- a/fs/ocfs2/localalloc.c
+++ b/fs/ocfs2/localalloc.c
@@ -834,6 +834,7 @@ static int ocfs2_local_alloc_find_clear_bits(struct ocfs2_super *osb,
 
 	if (!alloc->id1.bitmap1.i_total) {
 		bitoff = -1;
+		numfound = 0;
 		goto bail;
 	}
 
diff --git a/fs/xfs/libxfs/xfs_dir2_node.c b/fs/xfs/libxfs/xfs_dir2_node.c
index a0cc5e240306..173986c5558c 100644
--- a/fs/xfs/libxfs/xfs_dir2_node.c
+++ b/fs/xfs/libxfs/xfs_dir2_node.c
@@ -550,6 +550,8 @@ xfs_dir2_leafn_add(
 		 */
 		lfloglow = leafhdr.count;
 		lfloghigh = -1;
+		highstale = 0; /* Make clang happy */
+		lowstale = 0; /* Make clang happy */
 	}
 
 	/*
diff --git a/fs/xfs/libxfs/xfs_ialloc.c b/fs/xfs/libxfs/xfs_ialloc.c
index bf161e930f1d..28024bd09307 100644
--- a/fs/xfs/libxfs/xfs_ialloc.c
+++ b/fs/xfs/libxfs/xfs_ialloc.c
@@ -2082,7 +2082,7 @@ xfs_difree_finobt(
 	struct xfs_agi			*agi = XFS_BUF_TO_AGI(agbp);
 	xfs_agnumber_t			agno = be32_to_cpu(agi->agi_seqno);
 	struct xfs_btree_cur		*cur;
-	struct xfs_inobt_rec_incore	rec;
+	struct xfs_inobt_rec_incore	rec = {}; /* gcc -Wmaybe-uninitialized false positive */
 	int				offset = agino - ibtrec->ir_startino;
 	int				error;
 	int				i;
diff --git a/fs/xfs/xfs_log_recover.c b/fs/xfs/xfs_log_recover.c
index bdc216e2c2c6..7ba3046c7ef4 100644
--- a/fs/xfs/xfs_log_recover.c
+++ b/fs/xfs/xfs_log_recover.c
@@ -990,7 +990,7 @@ xlog_verify_tail(
 	xfs_daddr_t		first_bad;
 	int			error = 0;
 	bool			wrapped;
-	xfs_daddr_t		tmp_tail;
+	xfs_daddr_t		tmp_tail = 0 /* -Wmaybe-uninitialized false positive */;
 	xfs_daddr_t		orig_tail = *tail_blk;
 
 	buffer = xlog_alloc_buffer(log, 1);
diff --git a/include/linux/sunrpc/cache.h b/include/linux/sunrpc/cache.h
index 0f64de7caa39..30a00762e920 100644
--- a/include/linux/sunrpc/cache.h
+++ b/include/linux/sunrpc/cache.h
@@ -297,7 +297,7 @@ static inline int get_time(char **bpp, time64_t *time)
 
 static inline time64_t get_expiry(char **bpp)
 {
-	time64_t rv;
+	time64_t rv = 0; /* gcc -Wmaybe-uninitialized false positive */
 	struct timespec64 boot;
 
 	if (get_time(bpp, &rv))
diff --git a/mm/filemap.c b/mm/filemap.c
index 1784478270e1..533adea3c349 100644
--- a/mm/filemap.c
+++ b/mm/filemap.c
@@ -832,7 +832,7 @@ static int __add_to_page_cache_locked(struct page *page,
 {
 	XA_STATE(xas, &mapping->i_pages, offset);
 	int huge = PageHuge(page);
-	struct mem_cgroup *memcg;
+	struct mem_cgroup *memcg = NULL; /* false positive of uninitialized warning: its uses depends on !huge */
 	int error;
 	void *old;
 
diff --git a/net/mac80211/mlme.c b/net/mac80211/mlme.c
index 5fa13176036f..c07f1abe7f4f 100644
--- a/net/mac80211/mlme.c
+++ b/net/mac80211/mlme.c
@@ -1530,7 +1530,7 @@ static u32 ieee80211_handle_pwr_constr(struct ieee80211_sub_if_data *sdata,
 {
 	bool has_80211h_pwr = false, has_cisco_pwr = false;
 	int chan_pwr = 0, pwr_reduction_80211h = 0;
-	int pwr_level_cisco, pwr_level_80211h;
+	int pwr_level_cisco = 0 /* gcc -Wmaybe-uninitialized false positive */, pwr_level_80211h;
 	int new_ap_level;
 	__le16 capab = mgmt->u.probe_resp.capab_info;
 
diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c
index 4bd1faf4f779..e5e47f6f9582 100644
--- a/net/mac80211/tx.c
+++ b/net/mac80211/tx.c
@@ -2493,7 +2493,7 @@ static struct sk_buff *ieee80211_build_hdr(struct ieee80211_sub_if_data *sdata,
 	bool tdls_peer;
 	bool multicast;
 	u16 info_id = 0;
-	struct ieee80211_chanctx_conf *chanctx_conf;
+	struct ieee80211_chanctx_conf *chanctx_conf = NULL; /* gcc -Wmaybe-uninitialized false positive */
 	struct ieee80211_sub_if_data *ap_sdata;
 	enum nl80211_band band;
 	int ret;
-- 
